= Cello Coding Standards =

[[TOC]]

== General Guidelines ==

 * Avoid repetition
 * Write code for humans first, computers second
 * Prefer stringent code to lenient code (e.g. `const int` instead of `const`)
 * Avoid repetition

== Components ==

 * Component names are CamelCase, preferably a single word, e.g. `Amr`, `Disk`, `Error`
 * There is exactly one subdirectory in the source tree for each component
 * Each component subdirectory `foo/` contains a `foo.dir` file: see `TEMPLATE/TEMPLATE.dir` for format
 * Components consist of one or more classes
 * Components should not overlap functionality
 * Dependencies between components should be minimized
 * There must be no dependency loops between components
 * The header file for a component `Foo` is `foo.h`
 * The header file for a class `bar` in component `Foo` is `foo_bar.h`
 * All header files are associated with some component...
 * Except the global `cello.h` include file

== Classes ==

 * Class names are CamelCase, e.g. `ArrayBlocked`, `Amr`
 * Class header files for class `Foo` are in `foo.h`
 * Class function implementations are in `foo.cpp`
 * If class `Foo` is accessed in a different component `Component`, it is included as `component_foo.h` (or `component.h`)
 * Inheritance is used to model "is-a" relationships, e.g. `ArrayBlocked` "is-a" `Array`
 * Composition is used to model "has-a" relationships, e.g. `Hierarchy` "has-a" `Level`
 * Composition is generally preferred to inheritance
 * Iterator class names begin with `It`, as in `ItLevelGridsAll`
 
== Functions ==

 * A helpful way to write a function is first write it as pseudo-code, then convert pseudo-code to comments
 * All functions should be associated with a class
 * Function names are short but descriptive
 * Function names are all lower-case, and may contain underscores
 * There should be few public functions in a class, no more than about a dozen per class
 * Public functions in a class must not expose the underlying data-structures, even simple scalars
 * Private functions end in an underscore `foo_()` to easily identify them
 * Implementations of functions should avoid referencing "this" unnecessarily (e.g. prefer `foo_(blah);` to `this->foo_(blah);`)

== Variables ==

 * All variables should be associated with a class
 * All variables should be private or protected
 * Variable names should be short but descriptive
 * Variable names should be all lower-case, and may contain underscores
 * Private variables end in an underscore `foo_` to easily identify them

== Files ==

 * Code and comments should be formatted to fit in 80 columns
 * C++ code is contained in `*.cpp` files
 * C++ headers are contained in `*.h` files
 * C code is contained in `*.c` files
 * C headers are contained in `*.h` files
 * Fortran code is contained in `*.F` files

== Code ==

 * When evaluating polynomials or polynomial-like expressions, e.g. "`ix + nx*iy + nx*ny*iz + `..." for index computations, write it as "`ix + nx*(iy + ny*iz)`"
 * For simple calculations that are ubiquitous (e.g. index calculations), use `cpp` macros or inline functions
 * Use "`bool`" for variables that are "`true`" or "`false`", and name as "`is_foo`"
 * Simplify boolean expressions; e.g. use "`if (is_foo)`" instead of "`if (is_foo == true)`", and "`is_foo = (foo == blah)`" instead of "`is_foo = (foo == blah) ? true : false`"
 * Avoid embedded constants except for 0 or 1
 * Use "`enum`" for related constants, e.g. "`const enum field_type {field_type_unknown, field_type_density, field_type_total_energy, ...}`"
  
== Error Handling ==

== Examples ==

{{{
#!cpp

  // For each level in the hierarchy...

  ItHierarchyLevels itl (*hierarchy);

  while (Level * level = itl++) {

    // For each local grid patch in the level...

    ItLevelGridsLocal itgl (*level);

    while (Grid * grid = itgl++) {

       // Advance hydro one timestep

       Method ppm;

       ppm.apply (*grid, dt);
    }
  }

}}}

