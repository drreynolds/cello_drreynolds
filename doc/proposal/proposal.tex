%0       1         2         3         4         5         6         7         8
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%
%
%
% \section{Petascale Astrophysics Review}
%   \subsection{\enzo}
%   \subsection{FLASH}
%   \subsection{CHOMBO}
%   \subsection{GADGET-2}
% 
% \section{Cello}
% \subsection{Science Goals}
% \subsection{Software Goals}
% \subsubsection{Adaptive Mesh Refinement}
% \subsubsection{Particles}
% \subsubsection{Hyperbolic and Elliptic Methods}
% \subsubsection{Dynamic Task Scheduling}
%    CHARM++
%
%


%=======================================================================
\documentclass{article}
%=======================================================================

\include{include}

%=======================================================================

\begin{document}

%=======================================================================
\TITLE{Petascale Adaptive Mesh Refinement}{James Bordner}{$Rev$}
%=======================================================================

%=======================================================================
\section{Project Summary} \label{s:summary}
%=======================================================================

%=======================================================================
\section{Project Description} \label{s:description}
%=======================================================================

%-----------------------------------------------------------------------
\subsection{Objectives and Expected Significance}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\subsection{Background and Technical Need}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\subsection{Research Description}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\subsection{Education and Human Resources}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\subsection{Plan of Work}
%-----------------------------------------------------------------------

%=======================================================================
\section{Results from Prior Support}
%=======================================================================
%=======================================================================
\section{References}
%=======================================================================
%=======================================================================
\section{Biographical Sketches}
%=======================================================================
%=======================================================================
\section{Budget}
%=======================================================================
%=======================================================================
\section{Current and Pending Support}
%=======================================================================
%=======================================================================
\section{Facilities and Special Considerations}
%=======================================================================

%=======================================================================
\section{Enhancements}
%=======================================================================

\begin{itemize}
 \item Require more rigorous coding standards compared to Enzo development
 \item Use object-oriented design, organize into components (subdirectories) of classes (*.hpp/*.cpp files)
 \item Auto-tune where possible--automatically optimize for cache-, parallel-, vector-, solver-, etc. parameters
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Adaptive Mesh Refinement}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Do not store a patch's global position, only local position relative to immediate neighbors, parent, and children. [Toward distributed AMR data-structure, and to address precision issues with deep AMR. Potential issues: boundary and initial conditions.] (see W013)
 \item For very deep AMR where coarser levels never complete their timestep, delete coarse levels to free storage.
 \item / Parallel Provide (or notify) neighboring patches with updated ghost zone data as soon as it's available.
 \item / Parallel Support temporary ``allocate as-needed'' ghost zones in addition to ``permanent'' ones
 \item Reduce tree-AMR node size by only storing parent, single neighbor, and single child. [Assuming one pointer for field data and SAMR patches indexed by single-precision offsets into parent patches, 32 bytes / tree-AMR and 48 bytes / patch-AMR]
 \item Relax rigid refinement criteria to inhibit excessive changes in octree-like tree refinement.
 \item Represent patch extents with (small) integer values relative to parent. [To reduce memory usage with deep AMR runs.] (see W012)
 \item Support both structured AMR (Enzo-like) and tree-based AMR
 \item Support flexible node types: memory-efficient versus compute-efficient.
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Arrays}
%-----------------------------------------------------------------------

\begin{itemize}
 \item Allow multiple root-level patches per MPI task. [To improve cache use for unigrid problems, and improve load-balancing for AMR.]
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Control}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Reduce implicit dependencies by dynamically allocating parallel tasks, ala CHARM++.(e.g. currently Enzo loops through patches within a level, but a given patch can proceed as soon as it has all its boundary data)
 \item Support optional uniform timesteps across all levels. [To improve parallel efficiency.]
 \item Support optional variable timestep sizes within each level. [To reduce synchronization costs when computing global CFL condition.]
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Storage}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Enforce strict control over data storage formats (e.g. files) (see W0009)
 \item Require that all stored data be accessed through standard interface functions that are independent of specific file formats (i.e., stored datasets are conceptually treated as objects)
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Fields}
%-----------------------------------------------------------------------
\begin{itemize}
 \item User-controlled optional floor/ceiling limits on individual Fields (ala ``tiny\_number'' in Enzo), with user-specified Error behavior (warning, error, ignore, reset to given floor/ceiling, etc.)
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Methods}
%-----------------------------------------------------------------------
\begin{itemize}
  \item  Integrate ``inits'' functionality into the main code
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Parallelization}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Load-balance by having over-loaded processors reassign tasks to random processes. [To reduce global communication for determining which processes are under-loaded]
 \item Load-balance using ``over-compensation'', since heavily-loaded processes tend to continue to become more heavily loaded (cosmology / star-formation application-dependent).
 \item Only use inter-core, inter-cpu, inter-node, etc. level-communicators to bound communicator size and manage communication nonuniformity. 
 \item Support multiple (hybrid) and flexible parallelization strategies, including MPI-1 (2-sided send/recv), MPI-2 (1-sided get/put), OMP, and optionally UPC and GPU.
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Parameters}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Support for user-supplied code for problem initialization.
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Particles}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Store particle positions in single precision as -1 <= x,y,z <= 1 relative to their containing patch. [To reduce storage, improve performance, and address precision issues with deep AMR.]
 \item Use a binary tree data-structure to recursively partition the bounding boxes of particles.
\end{itemize}

%-----------------------------------------------------------------------
\subsection{Simulations}
%-----------------------------------------------------------------------
\begin{itemize}
 \item Support ensembles within a single run, including inline-analysis
\end{itemize}

\end{document}

%==================================================================

