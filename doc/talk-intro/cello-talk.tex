%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    This LaTeX source was automatically generated by outlinebeamer.pl     %
%                                                                          %
%   Remember that most changes should be made to the outline source file   %
% changes to this file will be overwritten when the file gets regenerated  %
%                                                                          %
%                  outlinebeamer - Outline Beamer Class Presentation Maker %
%                                    http://outlinebeamer.sourceforge.net/ %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass{beamer}
\newcommand{\Code}[1]{\textsf{#1}}
\newcommand{\cello}{\textsf{Cello}}
\newcommand{\enzo}{\textsf{Enzo}}
\usetheme{Copenhagen}
\usecolortheme{default}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\us}[1]{\color{blue}{#1}}
\newcommand{\them}[1]{\color{red}{#1}}
\newcommand{\newus}[1]{\color{magenta}{#1}}
\newcommand{\good}{\textcolor{green}{\smiley}}
\newcommand{\bad}{\textcolor{red}{\frownie}}
\newcommand{\colorcode}[1]{\textcolor{blue}{\code{#1}}}
\def\enhance<#1>{%
 \temporal<#1>{\color{gray}}{\color{blue}}{\color{gray}}}
%======================================================================
\title[The \cello\ Project]
      {The \cello\ Project \\ \small{\enzo: The Next Generation}}
\author[James Bordner]{\small Laboratory for Computational Astrophysics \\ San Diego Supercomputer Center \\ University of California, San Diego \\ \ \\ James Bordner}
\date{\today}
\begin{document}
\frame{\titlepage}
\frame{\tableofcontents}
\AtBeginSubsection[]
{
  \begin{frame}<beamer>
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}



\section{Overview}
    \begin{frame}[fragile] \frametitle{Outline}
      \begin{itemize}
        \item Overview
        \item User Perspective
        \begin{itemize}
          \item Parameter files
          \item Examples
        \end{itemize}
        \item AMR Data Structures
        \begin{itemize}
          \item Other AMR codes
          \item Cello Patch AMR
          \item Cello Tree AMR
        \end{itemize}
        \item Code Architecture
        \begin{itemize}
          \item Components
          \item Hardware interface components
          \item Method component
          \item Data structures
          \item Control
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Goals}
      \begin{itemize}
        \item \enzo: The Next Generation
        \item Computational science tool for next 10+ years
        \item Many competing design goals:
        \begin{itemize}
          \item Scalable to O($10^{5+}$)  cores
          \item Easy to use, modify, adapt, maintain
          \item Quality control
          \item \textit{Science capabilities}
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Target Classes of Users}
      \begin{itemize}
        \item \enhance<1>\textbf<1>{Students}
        \begin{itemize}
          \item \enhance<1>easy to define problem, run, and analyze
          \item \enhance<1>minimal software-related ``gotcha's''
        \end{itemize}
        \item \enhance<2>\textbf<2>{Physics experts}
        \begin{itemize}
          \item \enhance<2>deep control of physics parameters
          \item \enhance<2>flexible problem set up for wide range of problems
        \end{itemize}
        \item \enhance<3>\textbf<3>{Numerical experts}
        \begin{itemize}
          \item \enhance<3>deep control of method parameters
          \item \enhance<3>easy to incorporate new methods
        \end{itemize}
        \item \enhance<4>\textbf<4>{Computing experts}
        \begin{itemize}
          \item \enhance<4>deep control of data structures
          \item \enhance<4>AMR, parallelization, data distribution, blocking/padding
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Target Classes of Problems}
More AMR $\rightarrow$ more data dependencies $\rightarrow$ less parallelism
      \begin{itemize}
        \item \enhance<1>\textbf{Single-resolution (``unigrid'')}
        \begin{itemize}
          \item  \enhance<1>Parallelizes fully
          \item  \enhance<1>\enzo\ does well, but still room for improvement
        \end{itemize}
        \item \enhance<2>\textbf{Shallow multi-resolution}
        \item \enhance<3>\textbf{Deep multi-resolution}
        \item \enhance<4>\textbf{\textit{Extreme} multi-resolution}
        \begin{itemize}
          \item \enhance<4>Most difficult to parallelize effectively
          \item \enhance<4>\enzo\ does not scale well with hierarchy depth
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Petascale Performance Issues}
      \begin{itemize}
        \item Synchronization
        \item Task size control
        \begin{itemize}
          \item Large enough to be efficient
          \item Small enough for sufficient parallelism
        \end{itemize}
        \item Task scheduling
        \begin{itemize}
          \item Static scheduling with dynamic load balancing
          \item Dynamic scheduling with job migration
          \item Controlable via, e.g., CHARM++
        \end{itemize}
        \item Load balancing
        \item Software resiliency
        \item Restarts
        \item AMR performance issues
        \begin{itemize}
          \item Finding patch neighbors
          \item Parallel gridding algorithms
          \item Memory usage
          \item Elliptic solves: gravity / radiation
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Parameter Files}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components: Hardware}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components: AMR data structures}
\end{frame}

    \begin{frame}[fragile] \frametitle{Review of AMR Approaches}
    \footnotesize
      \begin{tabular}{|l|ccc|cc|}
\hline
    &  \textbf{Enzo} & \textbf{Chombo} & \textbf{Paramesh} & \textbf{Cello-patch} & \textbf{Cello-tree} \\  \hline
    \textbf{Refinement} &  \us{patch} & \them{patch} &  \them{tree} & \newus{patch} & \newus{tree}  \\
    \textbf{Tree type} & \us{none} & \them{octree} & \them{octree} & \newus{octree} & \newus{octree++} \\  \hline
    \textbf{Parents} & \us{    single} & \them{multiple} & \them{single} &   \newus{multiple} & \newus{single} \\
    \textbf{Children} & \us{variable} & \them{variable} & \them{constant} & \newus{variable} & \newus{limited} \\
    \textbf{Neighbors} & \us{variable} & \them{variable} & \them{limited} & \newus{variable} & \newus{limited} \\\hline
    \textbf{Level jumps} & \us{ yes} &    \them{no} &      \them{no}    &   \newus{no} & \newus{no} \\
    \textbf{Symmetric} & \us{no} &  \them{yes} &  \them{yes} &  \newus{yes} & \newus{yes} \\\hline
    \textbf{Patch shape} & \us{  variable} & \them{variable} &  \them{constant} & \newus{variable} & \newus{constant}(?) \\
    \textbf{Patch size} & \us{  variable} & \them{variable} &  \them{constant} & \newus{variable} &\newus{limited}  \\ \hline
      \end{tabular}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components: \code{Array} + \code{Amr}}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components: \code{Array}}
\end{frame}

    \begin{frame}[fragile] \frametitle{Software Components: \code{Amr}}
\end{frame}

    \begin{frame}[fragile] \frametitle{Control}
      \begin{itemize}
        \item Task: advance grid patch one timestep
        \item Dependencies: boundary values
        \item Dynamic task scheduling
        \begin{itemize}
          \item No artificial dependencies imposed
          \item Patches in different levels can advance concurrently
          \item CHARM++ would be helpful
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Local adaptive time-stepping}
      \begin{itemize}
        \item \enzo\ supports adaptive time-stepping between levels
        \item Fully adaptive time-stepping option
        \begin{itemize}
          \item No global timestep restriction
          \item No global synchronization
        \end{itemize}
        \item Uniform time-stepping option
        \begin{itemize}
          \item High parallel efficiency
          \item Simplified code
          \item Happy
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Particle positions}
      \begin{itemize}
        \item Particles are associated with a patch
        \item Represent particles in patch-local coordinates
        \item Simple coordinate transformation when particles migrate
        \item Single-precision sufficient
        \item Global coordinates
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Hierarchical Load balancing}
\end{frame}

    \begin{frame}[fragile] \frametitle{Precision issues: Particles}
      \begin{itemize}
        \item Use local coordinate system when possible
        \begin{itemize}
          \item Particles coordinates [0:1] in containing grid patch
          \item Simple coordinate transform when containing patch changes
          \item Single precision sufficient
          \begin{itemize}
            \item Save memory
            \item Save time
          \end{itemize}
        \end{itemize}
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Precision issues: Grids}
      \begin{itemize}
        \item Define grid location only relative to neighboring grid
        \item 32-bit integerss always sufficient
        \item No global tree structure
        \item Issues
        \begin{itemize}
          \item Load balancing
          \begin{itemize}
            \item CHARM++
          \end{itemize}
          \item Re-gridding
          \begin{itemize}
            \item local algorithm
          \end{itemize}
          \item Global time step
        \end{itemize}
        \item High scalability
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{Gravity}
      \begin{itemize}
        \item Hypre insufficient
        \begin{itemize}
          \item Best method FAC is unusable
        \end{itemize}
        \item Write own FAC
        \item Chombo group is on top of this
      \end{itemize}
\end{frame}

    \begin{frame}[fragile] \frametitle{AMR: Octree variations}
\begin{minipage}{2.5in}
\includegraphics<1>[width=2.5in]{dots.png}
\includegraphics<2>[width=2.5in]{dots-4-0.png}
\includegraphics<3>[width=2.5in]{dots-4-1.png}
\end{minipage} \
\begin{minipage}{2.5in}
      \begin{itemize}
        \item \enhance<1>Want to refine on single points
        \item \enhance<2>Simple quad-tree has level jumps
        \item \enhance<3>Normalization helps but problems
        \begin{itemize}
          \item \enhance<3>Numerous patches
          \item \enhance<3>Slow refinement
        \end{itemize}
      \end{itemize}
\end{minipage}
\end{frame}

    \begin{frame}[fragile] \frametitle{AMR: Octree issues}
\centerline{
\includegraphics<4>[width=2.5in]{dots-4-2.png}
\includegraphics<5>[width=2.5in]{dots-4-3.png}
\includegraphics<6>[width=2.5in]{dots-4-4.png}
\includegraphics<7>[width=2.5in]{dots-4-5.png}
\includegraphics<8>[width=2.5in]{dots-16-0.png}
\includegraphics<9>[width=2.5in]{dots-16-1.png}
\includegraphics<10>[width=2.5in]{dots-16-2.png}
\includegraphics<11>[width=2.5in]{dots-16-3.png}
\includegraphics<12>[width=2.5in]{dots-16-4.png}
\includegraphics<13>[width=2.5in]{dots-16-5.png}
\includegraphics<14>[width=2.5in]{cosmo2.png}
\includegraphics<15>[width=2.5in]{cosmo2-4-0.png}
\includegraphics<16>[width=2.5in]{cosmo2-4-1.png}
\includegraphics<17>[width=2.5in]{cosmo2-4-2.png}
\includegraphics<18>[width=2.5in]{cosmo2-4-3.png}
\includegraphics<19>[width=2.5in]{cosmo2-4-4.png}
\includegraphics<20>[width=2.5in]{cosmo2-4-5.png}
\includegraphics<21>[width=2.5in]{cosmo2-16-0.png}
\includegraphics<22>[width=2.5in]{cosmo2-16-1.png}
\includegraphics<23>[width=2.5in]{cosmo2-16-2.png}
\includegraphics<24>[width=2.5in]{cosmo2-16-3.png}
\includegraphics<25>[width=2.5in]{cosmo2-16-4.png}
\includegraphics<26>[width=2.5in]{cosmo2-16-5.png}
}
\end{frame}

    \begin{frame}[fragile] \frametitle{AMR: Octree examples}
\centerline{
\includegraphics<1>[width=1in]{norman-10.png}
}
\end{frame}







\end{document}
