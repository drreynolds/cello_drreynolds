current:pdf html

PAPER = `pwd | awk 'BEGIN{FS="/"}{print $$NF}'`

#-----------------------------------------------------------------------
# BUILD
#-----------------------------------------------------------------------

.PHONY: pdf
pdf: include.tex uml figures
	pdflatex $(PAPER).tex
	pdflatex $(PAPER).tex
	$(MAKE) install-pdf

.PHONY: html
html:
	tth -e2 $(PAPER).tex > $(PAPER).html
	$(MAKE) install-html


# For splitting proposal and bibliography in NSF grants

.PHONY: nsf
nsf: pdf
	pdftk $(PAPER).pdf cat 1-15   output $(PAPER)2.pdf
	pdftk $(PAPER).pdf cat 16-end output bibliography.pdf
	mv $(PAPER)2.pdf $(PAPER).pdf

#-----------------------------------------------------------------------
# BIBLIOGRAPHY
#-----------------------------------------------------------------------

bib: 
	bibtex $(PAPER)

#-----------------------------------------------------------------------
# LINKS
#-----------------------------------------------------------------------

figures:
	-@ln -s ../figures/* .

uml:
	ln -s ../uml .
	$(MAKE) -C uml

include.tex:
	ln -s ../include.tex .

#-----------------------------------------------------------------------
# INSTALL
#-----------------------------------------------------------------------

.PHONY: install-%

install-pdf:
	if [ ! -e ../pdf ]; then mkdir ../pdf; fi
	cp $(PAPER).pdf ../pdf
install-html:
	if [ ! -e ../html ]; then mkdir ../html; fi
	cp $(PAPER).html ../html

#-----------------------------------------------------------------------
# CLEAN
#-----------------------------------------------------------------------

.PHONY: clean

clean:
	-@rm -f *~ *.aux \
        $(PAPER).bbl \
        $(PAPER).blg \
        $(PAPER).dvi \
        $(PAPER).html \
        $(PAPER).log \
        $(PAPER).nav \
        $(PAPER).out \
        $(PAPER).pdf \
        $(PAPER).ps \
        $(PAPER).snm \
        $(PAPER).toc \
        $(PAPER).vrb

#-----------------------------------------------------------------------

.PHONY: distclean

distclean: clean
	-@rm uml include.tex 
#	-@rm makefile # Must be last!
