#=======================================================================
#
# Targets
#
#    all
#    test
#    dep
#    clean
#    install
#
#=======================================================================

.PHONY: all
all: dep objs $(TESTS) $(EXES)

.PHONY: objs
objs: $(OBJS) install-objs

#-----------------------------------------------------------------------

.PHONY: test
test: $(TESTS) run-tests
	@echo "Making $(PACKAGE) tests"

.PHONY: run-tests
run-tests: $(patsubst %,run-test-%,$(TESTS))

run-test-%: %
	    -./$*

#-----------------------------------------------------------------------
.PHONY: dep
dep:  $(patsubst %,dep-%,$(DIRS))
	-@(touch DEPEND; makedepend -fDEPEND -ignore {CIncludes} $(INC) -- -- *.cpp *.hpp 2> /dev/null)

.PHONY: dep-%
dep-%:
	-@(cd $*; touch DEPEND; makedepend -fDEPEND -ignore {CIncludes} $(INC) -- -- *.cpp *.hpp 2> /dev/null)

#-----------------------------------------------------------------------

.PHONY: clean
clean: clean-local
	@echo "Cleaning src/$(PACKAGE)"
	-@(rm -f *~ *.o DEPEND.bak)
	-@(rm -f $(TESTS) $(EXES) *.unit)
# lex.yy.c 
# *.hdf5 
# *.eps
# lib*.a
# Makefile.bak
# *.out
# out.make.dep
# parse.c parse.tab.? *.png 


#-----------------------------------------------------------------------

.PHONY: install
install: install-include install-objs $(patsubst %,copy-bin-%,$(TESTS) $(EXES)) 

copy-bin-%: %
	cp $* $(TOP)/bin

.PHONY: install-objs
install-objs: $(OBJS)
	ar rcu $(TOP)/lib/libcello.a      $(OBJS)   
	ar rcu $(TOP)/lib/lib$(PACKAGE).a $(OBJS)

#-----------------------------------------------------------------------

